name: Generate Morning Content

on:
  workflow_dispatch:
  schedule:
    # æ¯æ—¥æœ7æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã«å®Ÿè¡Œï¼ˆUTC 22:00 = JST 07:00ï¼‰
    - cron: '0 22 * * *'

jobs:
  check-api-keys:
    uses: ./.github/workflows/api-key-check.yml
    secrets: inherit
    
  generate-text:
    needs: check-api-keys
    uses: ./.github/workflows/text-generator.yml
    secrets: inherit
    
  generate-image:
    needs: [generate-text]
    uses: ./.github/workflows/image-generator.yml
    secrets: inherit
    
  upload-to-fal:
    needs: [generate-image]
    uses: ./.github/workflows/fal-uploader.yml
    secrets: inherit
    
  post-to-discord:
    needs: [generate-text, generate-image, upload-to-fal]
    uses: ./.github/workflows/discord-sender.yml
    secrets: inherit
    with:
      message: |
        ğŸ¬ ${{ needs.generate-text.outputs.scene-description }}
        
        ã¾ã‚ã²ãªãŸã€Œ${{ needs.generate-text.outputs.mamehina-dialogue }}ã€
        ã‚­ãƒ—ãƒ•ã‚§ãƒ«ã€Œ${{ needs.generate-text.outputs.kipferl-dialogue }}ã€
        
        ğŸ–¼ï¸ ${{ needs.upload-to-fal.outputs.fal-url }}
    
  summary:
    needs: [generate-text, generate-image, upload-to-fal, post-to-discord]
    runs-on: ubuntu-latest
    
    steps:
    - name: Display Final Results
      run: |
        echo "ğŸ‰ Morning content generation & posting completed!"
        echo ""
        echo "ğŸ¬ Scene: ${{ needs.generate-text.outputs.scene-description }}"
        echo "ğŸ‘§ ã¾ã‚ã²ãªãŸ: ${{ needs.generate-text.outputs.mamehina-dialogue }}"
        echo "ğŸ± ã‚­ãƒ—ãƒ•ã‚§ãƒ«: ${{ needs.generate-text.outputs.kipferl-dialogue }}"
        echo "ğŸ–¼ï¸ Image generation: âœ…"
        echo "ğŸ“¤ FAL Upload: âœ…"
        echo "ğŸ”— FAL URL: ${{ needs.upload-to-fal.outputs.fal-url }}"
        echo "ğŸ’¬ Posted to Discord: âœ…"
        echo ""
        echo "âœ… All done! Check your Discord for the post."