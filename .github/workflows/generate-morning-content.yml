name: Generate Morning Content

on:
  workflow_dispatch:
  schedule:
    # 毎日朝7時（日本時間）に実行（UTC 22:00 = JST 07:00）
    - cron: '0 22 * * *'

jobs:
  check-api-keys:
    uses: ./.github/workflows/api-key-check.yml
    secrets: inherit
    
  generate-text:
    needs: check-api-keys
    uses: ./.github/workflows/text-generator.yml
    secrets: inherit
    
  generate-image:
    needs: [generate-text]
    uses: ./.github/workflows/image-generator.yml
    secrets: inherit
    
  upload-to-fal:
    needs: [generate-image]
    uses: ./.github/workflows/fal-uploader.yml
    secrets: inherit
    
  post-to-discord:
    needs: [generate-text, generate-image, upload-to-fal]
    uses: ./.github/workflows/discord-sender.yml
    secrets: inherit
    with:
      message: |
        🎬 ${{ needs.generate-text.outputs.scene-description }}
        
        まめひなた「${{ needs.generate-text.outputs.mamehina-dialogue }}」
        キプフェル「${{ needs.generate-text.outputs.kipferl-dialogue }}」
        
        🖼️ ${{ needs.upload-to-fal.outputs.fal-url }}
    
  summary:
    needs: [generate-text, generate-image, upload-to-fal, post-to-discord]
    runs-on: ubuntu-latest
    
    steps:
    - name: Display Final Results
      run: |
        echo "🎉 Morning content generation & posting completed!"
        echo ""
        echo "🎬 Scene: ${{ needs.generate-text.outputs.scene-description }}"
        echo "👧 まめひなた: ${{ needs.generate-text.outputs.mamehina-dialogue }}"
        echo "🐱 キプフェル: ${{ needs.generate-text.outputs.kipferl-dialogue }}"
        echo "🖼️ Image generation: ✅"
        echo "📤 FAL Upload: ✅"
        echo "🔗 FAL URL: ${{ needs.upload-to-fal.outputs.fal-url }}"
        echo "💬 Posted to Discord: ✅"
        echo ""
        echo "✅ All done! Check your Discord for the post."